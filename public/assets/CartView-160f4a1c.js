import{_ as F}from"./Button-d43c7df3.js";import{_ as A,r,A as U,y as T,D as B,o as v,c as p,l as s,f as t,t as c,g as y,e as b,h as N,k as P,m as $,q as M,F as z,b as O,s as j,G as E,x as g,p as q,j as G,z as J}from"./index-e6eb8d31.js";import{a as L}from"./index-e64505e3.js";const u=f=>(q("data-v-7cf6b25a"),f=f(),G(),f),R={key:0,class:"modal-overlay"},Y={class:"modal"},H={class:"m-wrapper"},K=u(()=>t("h3",null,"一組帳號只能在同日期買五張票",-1)),Q={class:"m-userTickets"},W=u(()=>t("p",null,"目前",-1)),X=u(()=>t("p",null,"可再購買",-1)),Z=u(()=>t("p",{class:"m-title"},"購票須知",-1)),tt=u(()=>t("div",{class:"m-ticketInfo"},[t("div",null,[t("p",null,"成人票 : 18歲以上"),t("p",null,"兒童票 :08~ 18歲")]),t("div",null,[t("p",null,"優待票 :需有殘障手冊證明"),t("p",null,"免費:08歲以下免費")])],-1)),et={class:"btn"},at={class:"cart"},nt={class:"timeInfoBar"},st={class:"timepicker"},ot=u(()=>t("h2",null,"日期：",-1)),ct=["min"],lt={key:1},it={class:"ticketInfo"},dt={class:"counter"},ut=["onClick"],rt=["onClick"],vt=E('<section data-v-7cf6b25a><div class="payment" data-v-7cf6b25a><h3 class="payment-title" data-v-7cf6b25a>信用卡支付</h3><div class="payment-content" data-v-7cf6b25a><div data-v-7cf6b25a><p data-v-7cf6b25a>信用卡</p><input class="big-input" type="text" placeholder="4136815292895026" data-v-7cf6b25a></div><div class="twoInputBox" data-v-7cf6b25a><div data-v-7cf6b25a><p data-v-7cf6b25a>過期日</p><input class="small-input" type="text" placeholder="10/18" data-v-7cf6b25a></div><div data-v-7cf6b25a><p data-v-7cf6b25a>CVC</p><input class="small-input" type="text" placeholder="212" data-v-7cf6b25a></div></div><div data-v-7cf6b25a><p data-v-7cf6b25a>優惠碼</p><input class="big-input" type="text" data-v-7cf6b25a></div></div></div></section>',1),pt=u(()=>t("hr",null,null,-1)),_t={class:"pricePaybox"},ft={__name:"CartView",setup(f){const m=r(!1),o=r(""),C=r(0),i=r({allTicketsInfo:[],count:0}),l=r({count:0,findTodayUnuseTicket:[]});r(),U(async()=>{var a;try{const e=await T.get("/api/v1/ticketCategory");i.value.allTicketsInfo=e.data.allTicketsInfo,i.value.allTicketsInfo.forEach(h=>{h.amount=0}),i.value.count=e.data.count;const n=(await T.get("/api/v1/userTickets/getTickets")).data;if(n.length>0){const h=(a=n[0])==null?void 0:a.ticketDate,k=L(h);l.value.count=n.length,l.value.findTodayUnuseTicket=n,o.value=k}}catch(e){console.error(e);return}});const I=function(){m.value=!m.value},S=(a,e)=>{_.value+(e?1:-1)<=5?e?5-l.value.count-_.value>0?(a.amount=(a.amount||0)+1,x()):alert("一組帳號只能在同日期買五張票"):a.amount>0&&(a.amount--,x()):alert("一組帳號只能買五張票")},D=()=>{const a=new Date,e=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${e}-${d}-${n}`};function x(){C.value=i.value.allTicketsInfo.reduce((a,e)=>a+(e.amount||0)*e.price,0)}const _=B(()=>i.value.allTicketsInfo.reduce((a,e)=>a+(e.amount||0),0));let w;async function V(){if(!o.value)return alert("請輸入日期");if(_.value===0)return alert("請加購票券");clearTimeout(w),w=setTimeout(async()=>{const a=i.value.allTicketsInfo.filter(e=>e.amount!==0).map(e=>({ticketDate:o.value,ticketId:e._id,amount:e.amount}));if(o.value&&_.value>0)try{const e=await T.post("/api/v1/order",a);localStorage.setItem("order",JSON.stringify(e.data)),J.push("/user/order")}catch(e){alert(e.response.data.msg)}},500)}return(a,e)=>{const d=F;return v(),p("div",null,[s(m)?(v(),p("div",R,[t("div",Y,[t("div",H,[K,t("div",Q,[t("div",null,[W,t("h4",null,c(s(o)?s(o):"無購買票")+" "+c(s(l).count!==0?`有${s(l).findTodayUnuseTicket.length}張`:""),1)]),t("div",null,[X,t("h4",null,c(5-(s(l).findTodayUnuseTicket?s(l).findTodayUnuseTicket.length:0))+"張票 ",1)])]),Z,tt,t("div",et,[y(d,{btnFontSize:"0.5",onClick:I},{default:b(()=>[g("返回")]),_:1})])])])])):N("",!0),t("main",null,[t("section",null,[t("div",at,[t("div",nt,[t("div",st,[ot,s(l).count===0?P((v(),p("input",{key:0,type:"date","onUpdate:modelValue":e[0]||(e[0]=n=>M(o)?o.value=n:null),onChange:e[1]||(e[1]=(...n)=>a.handleDateChange&&a.handleDateChange(...n)),class:"date-input",min:D()},null,40,ct)),[[$,s(o)]]):(v(),p("h2",lt,c(s(o)),1))]),y(d,{btnFontSize:"0.3rem",onClick:I,class:"btn"},{default:b(()=>[g("暸解票券資訊")]),_:1})]),(v(!0),p(z,null,O(s(i).allTicketsInfo,(n,h)=>(v(),p("div",{class:"ticketsOrder",key:n._id},[t("div",it,[t("h4",null,c(n.ticketType)+" ("+c(n.fastTrack?"快速通關":"一般")+") ",1),t("p",null,c(n.price)+"元",1)]),t("div",dt,[t("div",{class:"box",onClick:k=>S(n,!1)}," - ",8,ut),t("p",null,c(n.amount||0),1),t("div",{class:"box",onClick:k=>S(n,!0)}," + ",8,rt)])]))),128))])]),vt]),pt,t("div",_t,[t("h3",null,"總價:"+c(s(C))+"元 ; 票數:"+c(s(_))+"張",1),y(d,{btnFontSize:"0.3rem",onClick:j(V,["prevent"]),btnColor:"#0694A7"},{default:b(()=>[g("支付")]),_:1},8,["onClick"])])])}}},Tt=A(ft,[["__scopeId","data-v-7cf6b25a"]]);export{Tt as default};
