import{_ as P}from"./TicketHistory-a218f8af.js";import{_ as w}from"./Button-d43c7df3.js";import{b as Q}from"./browser-e933942f.js";import{_ as C,r as u,A as $,o as n,c as l,h as I,f as e,t as _,g as d,B as R,l as c,C as q,d as D,e as y,x as T,y as x,D as F,E as G,z,F as N,b as U,p as j,j as A}from"./index-e6eb8d31.js";import{g as B,a as E}from"./index-e64505e3.js";const L=["src"],J={__name:"QRCodeGenerator",props:{id:String},setup(r){const t=r,s=u(""),a=async()=>{if(t.id.trim()==="")return;const o={width:100,height:100},p=await Q.toDataURL(t.id,o);s.value=p};return $(()=>{a()}),(o,p)=>s.value?(n(),l("img",{key:0,src:s.value,alt:"QR Code"},null,8,L)):I("",!0)}},S=C(J,[["__scopeId","data-v-8b36f294"]]);const K={class:"ticket-box-content"},W={__name:"Tickets",props:["ticketData"],setup(r){const t=r;return(s,a)=>{const o=S;return n(),l("div",{class:"ticket-card",style:R({backgroundColor:c(B)(t.ticketData.status,t.ticketData.ticketCategoryId.ticketType)})},[e("div",K,[e("div",null,[e("p",null,_(t.ticketData.status==="used"?"已使用":"未使用"),1)]),e("h3",null,_(t.ticketData.ticketCategoryId.ticketType),1),e("h4",null,_(t.ticketData.ticketCategoryId.fastTrack?"快速通關":"一般票"),1)]),d(o,{id:t.ticketData._id},null,8,["id"])],4)}}},X=C(W,[["__scopeId","data-v-295f1ec1"]]);const Y={key:0,class:"modal-overlay"},Z={class:"box-content"},tt={class:"status"},et={class:"ticketitle"},st={key:1,class:"refundPrice-rwd"},ot={key:2,class:"btn-wrap"},ct={key:3,class:"btn-wrap"},nt={key:1,class:"refundPrice"},at={__name:"TicketInfoRefundModal",props:{isOpen:Boolean,currentTicketData:Object},setup(r,{emit:t}){const s=r,a=u(!0),o=u(!0),p=()=>{a.value=!0,o.value=!0,t("close"),t("refresh-tickets")},i=u(s.currentTicketData);q(()=>s.currentTicketData,v=>{i.value=v});function b(){a.value=!1,o.value=!1}const h=async()=>{x.get(`/api/v1/userTickets/refund/${i.value._id}`).then(v=>{a.value=!0,o.value=!0,t("close"),t("refresh-tickets")}).catch(v=>{console.log(v)})};return(v,k)=>{const f=S,g=w;return s.isOpen?(n(),l("div",Y,[e("div",{class:"card",style:R({backgroundColor:c(B)(c(i).status,c(i).ticketCategoryId.ticketType)})},[e("div",Z,[e("div",tt,[e("p",null,_(c(i).status==="used"?"已使用":"未使用"),1)]),e("div",et,_(c(i).ticketCategoryId.ticketType),1),e("h3",null,_(c(i).ticketCategoryId.fastTrack?"快速通關":"一般票"),1),c(a)?(n(),D(f,{key:0,id:c(i)._id,class:"qrcode-rwd"},null,8,["id"])):(n(),l("div",st,_(s.currentTicketData.currentPurchasePrice)+"元 ",1)),c(o)?(n(),l("div",ot,[d(g,{btnFontSize:"0.5",onClick:p},{default:y(()=>[T("返回")]),_:1}),d(g,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:b},{default:y(()=>[T("退票")]),_:1})])):(n(),l("div",ct,[d(g,{btnFontSize:"0.5",onClick:p},{default:y(()=>[T("不想退票")]),_:1}),d(g,{class:"btn",btnColor:"rgba(0,0,0,0)",btnHoverColor:"none",onClick:h},{default:y(()=>[T("我想退票")]),_:1})]))]),c(a)?(n(),D(f,{key:0,id:c(i)._id,class:"qrcode"},null,8,["id"])):(n(),l("div",nt,_(s.currentTicketData.currentPurchasePrice)+"元 ",1))],4)])):I("",!0)}}},it=C(at,[["__scopeId","data-v-83a43388"]]);const H=r=>(j("data-v-48392ebc"),r=r(),A(),r),rt={class:"title"},lt={key:0,class:"noTicketBox"},ut=H(()=>e("h2",null,"目前沒有訂票",-1)),_t=H(()=>e("div",{class:"title"},[e("h2",null,"使用紀錄")],-1)),dt={__name:"userTicketView",setup(r){const t=u([]),s=u(!1),a=u(null),o=u(!1),p=u([]),i=F(()=>{if(t.value.length>0){const k=t.value[0];return E(k.ticketDate)}});$(async()=>{h()});const b=k=>{k.status!=="used"&&(a.value=k,s.value=!0)},h=async()=>{const k=await x.get("/api/v1/userTickets/getTickets");t.value=k.data,t.value.length===0?o.value=!0:o.value=!1;const f=await x.get("/api/v1/userTickets/ticketHistory");p.value=f.data};function v(){z.push("/user/cart")}return(k,f)=>{const g=it,M=X,V=w,O=P;return n(),l("div",null,[d(g,{isOpen:s.value,onClose:f[0]||(f[0]=m=>s.value=!1),currentTicketData:a.value,onRefreshTickets:h},null,8,["isOpen","currentTicketData"]),e("main",null,[e("div",rt,[e("h3",null,_(c(i)),1)]),d(G,{name:"list",appear:"",tag:"div",class:"ticketBox"},{default:y(()=>[(n(!0),l(N,null,U(t.value,(m,pt)=>(n(),D(M,{key:m._id,ticketData:m,onClick:kt=>b(m)},null,8,["ticketData","onClick"]))),128))]),_:1}),o.value?(n(),l("div",lt,[ut,d(V,{onClick:v},{default:y(()=>[T("前往訂票頁面")]),_:1})])):I("",!0),_t,d(O,{ticketsHistory:p.value,status:0},null,8,["ticketsHistory"])])])}}},ht=C(dt,[["__scopeId","data-v-48392ebc"]]);export{ht as default};
